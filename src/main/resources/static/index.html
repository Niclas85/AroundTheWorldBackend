<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pixels Around the World</title>
  <script src="./js/world-steps.js" type="module"></script>
  <script src="./js/gallery.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>

</head>
<body>


<style>

  #scroll-buttons {
    position: fixed;
    top: 20px; /* Position von oben */
    right: 20px; /* Position von rechts */
    display: flex;
    flex-direction: row; /* Horizontale Anordnung */
    gap: 10px; /* Abstand zwischen Buttons */
    z-index: 1000; /* Sicherstellen, dass die Buttons Ã¼ber dem Content sind */
  }

  #scroll-buttons button {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 50px;
    height: 50px;
    border: none;
    border-radius: 50%;
    background-color: #007bff;
    color: #fff;
    cursor: pointer;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    transition: background-color 0.3s;
  }

  #scroll-buttons button:hover {
    background-color: #0056b3;
  }

  #scroll-buttons img {
    width: 24px;
    height: 24px;
  }


</style>

<div id="scroll-buttons" class="scroll-buttons">
  <button id="scroll-top" class="btn btn-primary">
    <img src="http://localhost:8080/icons/world-map.png" alt="Nach oben" width="20" height="20">
  </button>
  <button id="scroll-content" class="btn btn-primary">
    <img src="http://localhost:8080/icons/checkpoint.png" alt="Zu Content" width="20" height="20">
  </button>
  <button id="scroll-iframe" class="btn btn-primary">
    <img src="http://localhost:8080/icons/album.png" alt="Zum iFrame" width="20" height="20">
  </button>

</div>


<h1 class="my-4">Pixels Around The World</h1>
<world-steps id="travel-map"></world-steps>


<gallery-component id="gallery"></gallery-component>



<script>


  // Scroll-Buttons Funktionen
  document.getElementById('scroll-top').addEventListener('click', () => {
    window.scrollTo({ top: 0, behavior: 'smooth' });
  });

  document.getElementById('scroll-content').addEventListener('click', () => {
    const stopInfo = document.getElementById('stop-info');
    if (stopInfo) {
      stopInfo.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }
  });

  document.getElementById('scroll-iframe').addEventListener('click', () => {
    const gallery = document.getElementById('gallery');
    if (gallery) {
      gallery.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }
  });








  async function fetchAndSetStops(webComponentId, apiEndpoint) {
    try {
      const webComponent = document.getElementById(webComponentId);

      if (!webComponent) {
        console.error(`Web component with ID "${webComponentId}" not found.`);
        return;
      }

      // Use window.location.origin to dynamically determine the host
      const domain = window.location.origin;

      // Fetch stops from the API
      const response = await fetch(`${domain}${apiEndpoint}`);
      if (!response.ok) {
        console.error(`Failed to fetch stops: ${response.statusText}`);
        return;
      }

      const stops = await response.json();

      // Dynamically add domain to the preview URLs
      stops.forEach(stop => {
        if (stop.preview) {
          const encodedPreview = encodeURIComponent(stop.preview).replace(/%2F/g, '/'); // Preserve slashes
          stop.preview = `${domain}${encodedPreview.startsWith('/') ? '' : '/'}${encodedPreview}`;
        }
      });

      // Use the setStops method of the web component
      if (typeof webComponent.setStops === 'function') {
        webComponent.setStops(stops);
      } else {
        console.error('The web component does not support setStops method.');
      }
    } catch (error) {
      console.error('Error fetching and setting stops:', error);
    }
  }

  // Load stops dynamically
  document.addEventListener('DOMContentLoaded', () => {
    fetchAndSetStops('travel-map', '/api/stops');
  });



  // Event listener for stop clicks
  const mapComponent = document.getElementById('travel-map');
  mapComponent.addEventListener('stopClicked', (event) => {
    const { name, description, folder } = event.detail;


    // Update iframe content dynamically
    loadGallery(folder, "gallery");
  });

  function loadLocationContent(folder) {
    const iframe = document.getElementById('location-frame');
    iframe.src = `media/${folder}/location.html`;
  }




  async function loadGallery(stopName, componentId) {
    const apiUrl = `${window.location.origin}/api/gallery/${stopName}`;
    try {
      const response = await fetch(apiUrl);
      if (!response.ok) {
        throw new Error(`Failed to fetch gallery data: ${response.statusText}`);
      }

      const galleryData = await response.json();
      const component = document.getElementById(componentId);

      if (component) {
        const galleryComponent = document.querySelector('gallery-component');
        galleryComponent.setGallery(galleryData);
      } else {
        console.error(`Component with ID '${componentId}' not found.`);
      }
    } catch (error) {
      console.error('Error loading gallery:', error);
    }
  }



</script>
</body>
</html>
